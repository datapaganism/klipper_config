[gcode_macro START_PRINT]
; cura : START_PRINT BED_TEMP={material_bed_temperature_layer_0} EXTRUDER_TEMP={material_print_temperature_layer_0} AREA_START_X=%MINX% AREA_START_Y=%MINY% AREA_END_X=%MAXX% AREA_END_Y=%MAXY% MATERIAL={material_type}
; gcode parameters for area bed mesh
variable_parameter_AREA_START : 0,0
variable_parameter_AREA_END : 0,0

gcode:
   {% set bed_temp = params.BED_TEMP|default(40)|int %}
   {% set extruder_temp = params.EXTRUDER_TEMP|default(200)|int %}
   {% set bed_mesh = params.BED_MESH|default("default")|string %}
   #PER_MATERIAL_SETTINGS MATERIAL={params.MATERIAL|default("PLA")}
   M106 S0
   M140 S{bed_temp} ; Set Heat Bed temperature
   
   {% if printer.extruder.temperature < 160  %}
    M104 S160
   {% else %}
   {% set current_temp = printer.extruder.temperature|int %}
    M104 S{current_temp}
   {% endif %}

   M190 S{bed_temp} ; Wait for Heat Bed temperature
   G28 ; Home all axes
   
   Z_TILT_ADJUST
   
   #BED_MESH_CALIBRATE AREA_START={params.AREA_START|default("0,0")} AREA_END={params.AREA_END|default("0,0")}
   BED_MESH_PROFILE LOAD={bed_mesh}
   #BED_MESH_CALIBRATE
  
   G92 E0 ; Reset Extruder
   G28 ; Home all axes
   G1 Z2.0 F3000 ; Move Z Axis up little to prevent scratching of Heat Bed
   M104 S{extruder_temp} ; Set Extruder temperature
   M109 S{extruder_temp} ; Wait for Extruder temperature
   G1 X10.1 Y20 Z0.3 F5000.0 ; Move to start position
   G1 X10.1 Y195.0 Z0.3 F1500.0 E15 ; Draw the first line
   G1 X10.4 Y195.0 Z0.3 F5000.0 ; Move to side a little
   G1 X10.4 Y20 Z0.3 F1500.0 E30 ; Draw the second line
   G92 E0 ; Reset Extruder
   G1 Z2.0 F3000 ; Move Z Axis up little to prevent scratching of Heat Bed
   G1 X5 Y20 Z0.3 F5000.0 ; Move over to prevent blob squish
   G92 E0